<div ng-controller="reportsMCtrl" class="container-fluid">

    <form id="{{flow.getElementFlowId('reportFrame')}}" class="form-horizontal">

        <div class="col-lg-4">
            <fieldset>
                <legend>Options</legend>
                <div>
                    <div class="col-lg-10">
                        <flow-select disabled="!task.report.isYear" model="task.report.schoolYear"
                                     field-label="description" field-value="id" task="task" label="School Year"
                                     source-url="services/war/school_year_query/list"></flow-select>
                    </div>
                    <div class="col-lg-2">
                        <flow-check model="task.report.isYear"></flow-check>
                    </div>
                </div>

                <div>
                    <div class="col-lg-10">
                        <flow-select disabled="!task.report.isMonth"
                                     model="task.report.month" task="task" label="Month"
                                     source-url="factories/war/table_factories/months">

                        </flow-select>
                    </div>
                    <div class="col-lg-2">
                        <flow-check model="task.report.isMonth"></flow-check>
                    </div>
                </div>

                <div ng-hide="task.hideAgentFilter">
                    <div class="col-lg-10">
                        <flow-look-up disabled="!task.report.isAgent" model="task.agent" task="task" flow="flow"
                                      id="{{flow.getElementFlowId('agentLookUp')}}"
                                      label="Materials Advisor" parent-id="{{flow.getElementFlowId('reportFrame')}}"
                                      key-var="agent" field-label="user.flowUserDetail.fullName"
                                      source-url="services/war/agent_query/list">

                            <flow-sub-column title="Name" model="agent.user.flowUserDetail.fullName"></flow-sub-column>
                            <flow-sub-column title="Initials" model="agent.initials"></flow-sub-column>
                        </flow-look-up>
                    </div>

                    <div class="col-lg-2">
                        <flow-check model="task.report.isAgent"></flow-check>
                    </div>

                </div>

                <div>
                    <div class="col-lg-10">
                        <flow-look-up disabled="!task.report.isCustomer" model="task.customer" task="task"
                                      flow="flow"
                                      id="{{flow.getElementFlowId('customerLookUp')}}"
                                      label="Customer" parent-id="{{flow.getElementFlowId('reportFrame')}}"
                                      key-var="customer" field-label="school.name"
                                      source-url="services/war/customer_query/list">

                            <flow-sub-column title="Name" model="customer.school.name"></flow-sub-column>
                            <flow-sub-column title="Region"
                                             model="customer.school.region.regionCode"></flow-sub-column>
                        </flow-look-up>
                    </div>
                    <div class="col-lg-2">
                        <flow-check model="task.report.isCustomer"></flow-check>
                    </div>
                </div>

                <div ng-hide="task.hideAgentFilter">
                    <div class="col-lg-10">

                        <flow-select disabled="!task.report.isRegion" model="task.report.region" task="task"
                                     label="Region" field-label="regionCode" field-value="regionCode"
                                     source-url="services/war/region_query/list"></flow-select>
                    </div>
                    <div class="col-lg-2">
                        <flow-check model="task.report.isRegion"></flow-check>
                    </div>
                </div>

            </fieldset>
        </div>

        <div class="col-lg-8">
            <fieldset>
                <legend>Toggle Rows</legend>
                <div class="col-lg-12">

                    <div class="col-lg-3" ng-init="task.table.isCustomer = true">
                        <flow-check label="Customer" model="task.table.isCustomer"></flow-check>
                    </div>

                    <div class="col-lg-3" ng-init="task.table.isFp = true">
                        <flow-check label="Follow up Payment" model="task.table.isFp"></flow-check>
                    </div>

                    <div class="col-lg-3" ng-init="task.table.isUcis = true">
                        <flow-check label="Updated Customer Info Sheet" model="task.table.isUcis"></flow-check>
                    </div>

                </div>
                <div class="col-lg-12">
                    <div class="col-lg-3" ng-init="task.table.isYear = true">
                        <flow-check label="Year" model="task.table.isYear"></flow-check>
                    </div>

                    <div class="col-lg-3" ng-init="task.table.isGd = true">
                        <flow-check label="Giveaways Distribution" model="task.table.isGd"></flow-check>
                    </div>

                    <div class="col-lg-3" ng-init="task.table.isIes = true">
                        <flow-check label="Implemented Ex-Sem" model="task.table.isIes"></flow-check>
                    </div>

                </div>
                <div class="col-lg-12">
                    <div class="col-lg-3" ng-init="task.table.isFrequency = true">
                        <flow-check label="Number of Visits" model="task.table.isFrequency"></flow-check>
                    </div>
                    <div class="col-lg-3" ng-init="task.table.isDoi = true">
                        <flow-check label="Delivery of Incentive/Donation" model="task.table.isDoi"></flow-check>
                    </div>


                </div>
                <div class="col-lg-12">
                    <div class="col-lg-3" ng-init="task.table.isEcd = true">
                        <flow-check label="Exam Copies Distribution" model="task.table.isEcd"></flow-check>
                    </div>
                    <div class="col-lg-3" ng-init="task.table.isPo = true">
                        <flow-check label="Purchase Order" model="task.table.isPo"></flow-check>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="col-lg-3" ng-init="task.table.isIte = true">
                        <flow-check label="Invitation to Events" model="task.table.isIte"></flow-check>
                    </div>
                    <div class="col-lg-3" ng-init="task.table.isDaotrc = true">
                        <flow-check label="Delivery of Add'l Order / TRM / Compli"
                                    model="task.table.isDaotrc"></flow-check>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="col-lg-3" ng-init="task.table.isCoe = true">
                        <flow-check label="Confirmation of Events" model="task.table.isCoe"></flow-check>
                    </div>
                    <div class="col-lg-3" ng-init="task.table.isBooklist = true">
                        <flow-check label="Booklist" model="task.table.isBooklist"></flow-check>
                    </div>

                </div>
            </fieldset>
        </div>


        <div class="form-group">
            <table id="{{flow.getElementFlowId('reportTable')}}" class="table table-condensed table-striped"
                   ng-init="rep = []">
                <thead>
                <tr>
                    <th ng-if="!task.report.isCustomer && task.table.isCustomer" class="bg-info">Customer</th>
                    <th ng-if="!task.report.isYear && task.table.isYear" class="bg-info">Year</th>
                    <th ng-if="task.table.isFrequency" class="bg-info">Number of Visits</th>
                    <th ng-if="task.table.isEcd" class="bg-warning">Exam Copies Distribution</th>
                    <th ng-if="task.table.isIte" class="bg-warning">Invitation to Events</th>
                    <th ng-if="task.table.isCoe" class="bg-warning">Confirmation of Events</th>
                    <th ng-if="task.table.isFp" class="bg-warning">Follow up Payment</th>
                    <th ng-if="task.table.isGd" class="bg-warning">Giveaways Distribution</th>
                    <th ng-if="task.table.isDoi" class="bg-warning">Delivery of Incentive/Donation</th>
                    <th ng-if="task.table.isPo" class="bg-warning">Purchase Order</th>
                    <th ng-if="task.table.isDaotrc" class="bg-warning">Delivery of Add'l Order / TRM / Compli</th>
                    <th ng-if="task.table.isBooklist" class="bg-warning">Booklist</th>
                    <th ng-if="task.table.isUcis" class="bg-warning">Updated Customer Info Sheet</th>
                    <th ng-if="task.table.isIes" class="bg-warning">Implemented Ex-Sem</th>
                </tr>
                </thead>

                <tbody ng-repeat="(month , reports) in task.report.monthlyReports | groupBy: 'month.label'"
                       ng-init="rep[$index] = {}">
                <tr>
                    <td class="bg-warning" colspan="4"><span>{{month}}</span>

                        <div ng-if="!task.report.isCustomer" data-toggle="buttons"
                             class="btn-group btn-group-xs pull-right"
                             ng-init="rep[$index].limit = task.report.length">

                            <label class="btn btn-info active" ng-click="rep[$index].limit = task.report.length">
                                <input type="radio" name="options"
                                       autocomplete="off" checked> All
                            </label>
                            <label class="btn btn-info" ng-click="rep[$index].limit = 20">
                                <input type="radio" name="options"
                                       autocomplete="off"> Top 20
                            </label>
                            <label class="btn btn-info" ng-click="rep[$index].limit = 50">
                                <input type="radio" name="options" autocomplete="off">
                                Top 50
                            </label>
                        </div>
                    </td>
                </tr>
                <tr ng-repeat="day in reports| orderBy: 'index' : false | limitTo:rep[$index].limit ">
                    <td colspan="14">
                        <div class="margin-leftl5px">
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Customer"
                                 ng-if="!task.report.isCustomer && task.table.isCustomer" class="report-td">
                                <a href="#" flow-tooltip
                                   tooltip-my="bottom left"
                                   tooltip-at="top right"
                                   tooltip-title="{{day.customerName}}"><span
                                        style="font:inherit;font-size:9px">{{day.customerName | limitTo : 25}}</span></a>
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Year"
                                 ng-if="!task.report.isYear && task.table.isYear" class="report-td">{{day.year}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Number of Visits" ng-if="task.table.isFrequency" class="report-td">
                                {{day.customerFrequency}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Exam Copies Distribution" ng-if="task.table.isEcd" class="report-td">
                                {{day.ecd}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Invitation to Events" ng-if="task.table.isIte" class="report-td">
                                {{day.ite}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Confirmation of Events" ng-if="task.table.isCoe" class="report-td">
                                {{day.coe}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Follow up Payment" ng-if="task.table.isFp" class="report-td">
                                {{day.fp}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Giveaways Distribution" ng-if="task.table.isGd" class="report-td">
                                {{day.gd}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Delivery of Incentive/Donation" ng-if="task.table.isDoi"
                                 class="report-td">
                                {{day.doi}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Purchase Order" ng-if="task.table.isPo" class="report-td">
                                {{day.po}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Delivery of Add" ng-if="task.table.isDaotrc"
                                 class="report-td">{{day.daotrc}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Booklist" ng-if="task.table.isBooklist"
                                 class="report-td">{{day.bookList}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Updated Customer Info Sheet" ng-if="task.table.isUcis" class="report-td">
                                {{day.ucis}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Implemented Ex-Sem" ng-if="task.table.isIes" class="report-td">
                                {{day.ies}}
                            </div>
                        </div>
                    </td>
                </tr>

                </tbody>
            </table>

        </div>

    </form>


</div>