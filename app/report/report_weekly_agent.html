<div ng-controller="reportsCtrl" class="container-fluid">
    <form id="{{flow.getElementFlowId('reportFrame')}}" class="form-horizontal">
        <div column="width100pc padding0">
            <div column="2">
                <label class="width100pc">
                    <span>Year</span>
                    <ui-select ng-change="task.agentReport.yearFilterChange(task.agentReport.yearFilter)"
                               ng-model="task.agentReport.yearFilter" id="yearFilter">
                        <ui-select-match>{{$select.selected}}</ui-select-match>
                        <ui-select-choices repeat="year in task.agentReport.years | filter : $select.search"
                                           refresh="task.agentReport.getYears()">
                            {{year}}
                        </ui-select-choices>
                    </ui-select>
                </label>
            </div>
            <div column="2">
                <label class="width100pc">
                    <span>Month</span>
                    <ui-select ng-change="task.agentReport.monthFilterChange(task.agentReport.monthFilter)"
                               ng-model="task.agentReport.monthFilter" id="monthFilter">
                        <ui-select-match>{{$select.selected.label}}</ui-select-match>
                        <ui-select-choices repeat="month in task.agentReport.months | filter : {label:$select.search}"
                                           refresh="task.agentReport.getMonths()">
                            {{month.label}}
                        </ui-select-choices>
                    </ui-select>
                </label>
            </div>
            <div column="2">
                <label class="width100pc">
                    <span>Agent</span>
                    <ui-select ng-change="task.agentReport.agentFilterChange(task.agentReport.agentFilter)"
                               ng-model="task.agentReport.agentFilter" id="agentFilter"
                               ng-disabled="task.agentReport.disableAgentFilter">
                        <ui-select-match placeholder="{{task.loadAgent ? '': 'Loading agents...'}}">
                            {{$select.selected.user.flowUserDetail.fullName}}
                        </ui-select-match>
                        <ui-select-choices
                                repeat="agent in task.agentReport.agents | filter : {user:{flowUserDetail:{fullName:$select.search}}}"
                                refresh="task.agentReport.getAgents()">
                            {{agent.user.flowUserDetail.fullName}}
                        </ui-select-choices>
                    </ui-select>
                </label>
            </div>
            <div column="2">
                <label class="width100pc">
                    <span>Region</span>
                    <ui-select ng-change="task.agentReport.regionFilterChange(task.agentReport.regionFilter)"
                               ng-model="task.agentReport.regionFilter" id="regionFilter"
                               ng-disabled="task.agentReport.disableAgentFilter">
                        <ui-select-match placeholder="{{task.loadRegion ? '': 'Loading regions...'}}">
                            {{$select.selected.regionCode}}
                        </ui-select-match>
                        <ui-select-choices
                                repeat="region in task.agentReport.regions | filter : {regionCode:$select.search}"
                                refresh="task.agentReport.getRegions()">
                            {{region.regionCode}}
                        </ui-select-choices>
                    </ui-select>
                </label>
            </div>

            <div column="4" class="padding0">
                <div class="btn-group">
                    <div class="height7px"></div>
                    <button button primary="button" ng-click="task.agentReport.query()">Go</button>
                </div>
                <div class="btn-group">
                    <div class="height7px"></div>
                    <button button warning="button" ng-click="task.agentReport.clearFilter()">Clear</button>
                </div>
                <div class="btn-group dropdown">
                    <div class="height7px"></div>
                    <button button info="button" class="dropdown-toggle" data-toggle="dropdown"
                            aria-expanded="false">
                        <span>Columns</span>
                        <span class="caret"></span>
                        <span class="sr-only">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu toggle-columns" role="menu">
                        <li ng-init="task.table.isMaterialsAdvisor = true">
                            <a href="#"
                               ng-click="task.table.isMaterialsAdvisor=!task.table.isMaterialsAdvisor"><input
                                    type="checkbox" ng-model="task.table.isMaterialsAdvisor"> Materials Advisor</a>
                        </li>
                        <li ng-init="task.table.isWorkedWith=true">
                            <a href="#" ng-click="task.table.isWorkedWith=!task.table.isWorkedWith">
                                <input type="checkbox" ng-model="task.table.isWorkedWith"/> Worked with
                                Sales/Manager
                            </a>
                        </li>
                        <li ng-init="task.table.isWeek = true">
                            <a href="#"
                               ng-click="task.table.isWeek=!task.table.isWeek">
                                <input type="checkbox" ng-model="task.table.isWeek"/> Week
                            </a>
                        </li>
                        <li ng-init="task.table.isYear = true">
                            <a href="#"
                               ng-click="task.table.isYear=!task.table.isYear">
                                <input type="checkbox" ng-model="task.table.isYear"/> Year
                            </a>
                        </li>
                        <li ng-init="task.table.isPlannedTarget = true">
                            <a href="#"
                               ng-click="task.table.isPlannedTarget=!task.table.isPlannedTarget">
                                <input type="checkbox" ng-model="task.table.isPlannedTarget"/> Target
                            </a>
                        </li>
                        <li ng-init="task.table.isPlannedActual = true">
                            <a href="#"
                               ng-click="task.table.isPlannedActual=!task.table.isPlannedActual">
                                <input type="checkbox" ng-model="task.table.isPlannedActual"/> Actual
                            </a>
                        </li>
                        <li ng-init="task.table.isUnplannedActual = true">
                            <a href="#"
                               ng-click="task.table.isUnplannedActual=!task.table.isUnplannedActual">
                                <input type="checkbox" ng-model="task.table.isUnplannedActual"/> Unplanned
                            </a>
                        </li>
                        <li ng-init="task.table.isTotalCallProd = true">
                            <a href="#"
                               ng-click="task.table.isTotalCallProd=!task.table.isTotalCallProd">
                                <input type="checkbox" ng-model="task.table.isTotalCallProd"/> Call Productivity
                            </a>
                        </li>
                        <li ng-init="task.table.isEcd = true">
                            <a href="#"
                               ng-click="task.table.isEcd=!task.table.isEcd">
                                <input type="checkbox" ng-model="task.table.isEcd"/> Exam Copies Distribution
                            </a>
                        </li>
                        <li ng-init="task.table.isIte = true">
                            <a href="#"
                               ng-click="task.table.isIte=!task.table.isIte">
                                <input type="checkbox" ng-model="task.table.isIte"/> Invitation to Events
                            </a>
                        </li>
                        <li ng-init="task.table.isCoe = true">
                            <a href="#"
                               ng-click="task.table.isCoe=!task.table.isCoe">
                                <input type="checkbox" ng-model="task.table.isCoe"/>Confirmation of Events
                            </a>
                        </li>
                        <li ng-init="task.table.isFp = true">
                            <a href="#"
                               ng-click="task.table.isFp=!task.table.isFp">
                                <input type="checkbox" ng-model="task.table.isFp"/>Follow up Payment
                            </a>
                        </li>
                        <li ng-init="task.table.isGd = true">
                            <a href="#"
                               ng-click="task.table.isGd=!task.table.isGd">
                                <input type="checkbox" ng-model="task.table.isGd"/>Giveaways Distribution
                            </a>
                        </li>
                        <li ng-init="task.table.isDoi = true">
                            <a href="#"
                               ng-click="task.table.isDoi=!task.table.isDoi">
                                <input type="checkbox" ng-model="task.table.isDoi"/>Delivery of Incentive/Donation
                            </a>
                        </li>
                        <li ng-init="task.table.isPo = true">
                            <a href="#" ng-click="task.table.isPo=!task.table.isPo">
                                <input type="checkbox" ng-model="task.table.isPo"/>Purchase Order
                            </a>
                        </li>
                        <li ng-init="task.table.isDaotrc = true">
                            <a href="#" ng-click="task.table.isDaotrc=!task.table.isDaotrc">
                                <input type="checkbox" ng-model="task.table.isDaotrc"/>Delivery of Additional Order
                                /
                                TRM /
                                Compli
                            </a>
                        </li>
                        <li ng-init="task.table.isBooklist = true">
                            <a href="#" ng-click="task.table.isBooklist=!task.table.isBooklist">
                                <input type="checkbox" ng-model="task.table.isBooklist"/>Booklist
                            </a>
                        </li>
                        <li ng-init="task.table.isUcis = true">
                            <a href="#" ng-click="task.table.isUcis=!task.table.isUcis">
                                <input type="checkbox" ng-model="task.table.isUcis"/>Updated Customer Info Sheet
                            </a>
                        </li>
                        <li ng-init="task.table.isIes = true">
                            <a href="#" ng-click="task.table.isIes=!task.table.isIes">
                                <input type="checkbox" ng-model="task.table.isIes"/>Implemented Ex-Sem
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="btn-group dropdown">
                    <div class="height7px"></div>
                    <button button warning="button" class="dropdown-toggle" data-toggle="dropdown">
                        <span ng-if="!task.exporting">Export</span>
                        <span ng-if="!task.exporting" class="caret"></span>
                        <i ng-if="task.exporting" class="fa fa-spin fa-spinner"></i>
                    </button>
                    <ul ng-if="!task.exporting" class="dropdown-menu" role="menu">
                        <li><a href="#" ng-click="task.export('html')"><i fluid-icon-print></i> Print</a></li>
                        <li><a href="#" ng-click="task.export('csv')"><i class="fa fa-file-excel-o"></i> CSV</a>
                        </li>
                    </ul>
                </div>
                <div class="btn-group btn-group-lg">
                    <div class="height7px"></div>
                    <a ng-if="task.csvDownloadUrl" class="btn btn-success" ng-href="{{task.csvDownloadUrl}}"
                       download="{{task.csvDownloadName}}">Download
                        CSV</a>
                </div>
            </div>
        </div>

        <div class="form-group">
            <table id="{{flow.getElementFlowId('reportTable')}}" class="table table-condensed table-striped"
                   ng-init="rep = []">
                <thead>
                <tr>
                    <th class="bg-primary">{{!task.report.isAgent && task.table.isMaterialsAdvisor ? 'Materials Advisor'
                        :'Action'}}
                    </th>
                    <th class="bg-info" ng-if="task.table.isWorkedWith">Worked with Sales/Manager</th>
                    <th class="bg-info" ng-if="task.table.isWeek">Week</th>
                    <th ng-if="!task.report.isYear && task.table.isYear" class="bg-info">Year</th>
                    <th ng-if="task.table.isPlannedTarget" class="bg-info header">Target</th>
                    <th ng-if="task.table.isPlannedActual" class="bg-info header">Planned</th>
                    <th ng-if="task.table.isUnplannedActual" class="bg-info">Unplanned</th>
                    <th ng-if="task.table.isTotalActual" class="bg-info">Total Visited</th>
                    <th ng-if="task.table.isTotalCallProd" class="bg-success">Call Productivity</th>
                    <th ng-if="task.table.isEcd" class="bg-warning">Exam Copies Distribution</th>
                    <th ng-if="task.table.isIte" class="bg-warning">Invitation to Events</th>
                    <th ng-if="task.table.isCoe" class="bg-warning">Confirmation of Events</th>
                    <th ng-if="task.table.isFp" class="bg-warning">Follow up Payment</th>
                    <th ng-if="task.table.isGd" class="bg-warning">Giveaways Distribution</th>
                    <th ng-if="task.table.isDoi" class="bg-warning">Delivery of Incentive/Donation</th>
                    <th ng-if="task.table.isPo" class="bg-warning">Purchase Order</th>
                    <th ng-if="task.table.isDaotrc" class="bg-warning">Delivery of Additional Order / TRM / Compli</th>
                    <th ng-if="task.table.isBooklist" class="bg-warning">Booklist</th>
                    <th ng-if="task.table.isUcis" class="bg-warning">Updated Customer Info Sheet</th>
                    <th ng-if="task.table.isIes" class="bg-warning">Implemented Ex-Sem</th>
                </tr>
                </thead>

                <tbody ng-repeat="(month , reports) in task.report.weeklyReports | groupBy: 'reportMonth.label'"
                       ng-init="monthModel = {selectedWeek:0}">
                <tr>
                    <td class="bg-warning" colspan="3"><span>{{month}}</span></td>
                    <td class="borderless" colspan="2" border="0"><select ng-model="monthModel.selectedWeek">
                        <option value="1" label="Week 1"></option>
                        <option value="2" label="Week 2"></option>
                        <option value="3" label="Week 3"></option>
                        <option value="4" label="Week 4"></option>
                        <option value="5" label="Week 5"></option>
                        <option value="0" label="All week"></option>
                    </select></td>
                </tr>
                <tr ng-repeat="day in reports | filter : {week: monthModel.selectedWeek > 0 ? monthModel.selectedWeek : ''}">
                    <td colspan="19">
                        <div class="margin-leftl5px">
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="{{!task.report.isAgent && task.table.isMaterialsAdvisor ? 'Materials Advisor' :'Action'}}"
                                 class="report-td"><a href="#"
                                                      ng-click="task.getCustomers(day)"
                                                      flow-tooltip
                                                      tooltip-my="bottom left"
                                                      tooltip-at="top right"
                                                      tooltip-title="View {{day.materialsAdvisor}} daily activity for week {{day.week}}."><span><i
                                    ng-class="(day.view ? 'fa fa-search-minus' : 'fa fa-search-plus')"></i>
                {{ !task.report.isAgent && task.table.isMaterialsAdvisor ? day.materialsAdvisor : ''}}</span></a>
                            </div>

                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Worked with Sales/Manager" ng-if="task.table.isWorkedWith"
                                 class="report-td">{{day.workedWith}}
                            </div>

                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Week"
                                 ng-if="task.table.isWeek" class="report-td">{{day.week}}
                            </div>

                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Year"
                                 ng-if="!task.report.isYear && task.table.isYear" class="report-td">{{day.year}}
                            </div>

                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Target"
                                 ng-if="task.table.isPlannedTarget" class="report-td">{{day.plannedTarget}}
                            </div>

                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Planned"
                                 ng-if="task.table.isPlannedActual" class="report-td">{{day.plannedActual}}
                            </div>

                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Unplanned" ng-if="task.table.isUnplannedActual" class="report-td">
                                {{day.unplannedActual}}
                            </div>

                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Call Productivity" ng-if="task.table.isTotalCallProd"
                                 class="report-td">
                                {{ totalProductivity(day.plannedActual,day.unplannedActual, day.plannedTarget) |
                                setDecimal:
                                2}}%
                            </div>

                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Exam Copies Distribution" ng-if="task.table.isEcd" class="report-td">
                                {{day.ecd}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Invitation to Events" ng-if="task.table.isIte" class="report-td">
                                {{day.ite}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Confirmation of Events" ng-if="task.table.isCoe" class="report-td">
                                {{day.coe}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Follow up Payment" ng-if="task.table.isFp" class="report-td">
                                {{day.fp}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Giveaways Distribution" ng-if="task.table.isGd" class="report-td">
                                {{day.gd}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Delivery of Incentive/Donation" ng-if="task.table.isDoi"
                                 class="report-td">
                                {{day.doi}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Purchase Order" ng-if="task.table.isPo" class="report-td">
                                {{day.po}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Delivery of Additional Order / TRM / Compli" ng-if="task.table.isDaotrc"
                                 class="report-td">{{day.daotrc}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Booklist" ng-if="task.table.isBooklist"
                                 class="report-td">{{day.bookList}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Updated Customer Info Sheet" ng-if="task.table.isUcis" class="report-td">
                                {{day.ucis}}
                            </div>
                            <div fluid-render-width table-id="{{flow.getElementFlowId('reportTable')}}"
                                 header-name="Implemented Ex-Sem" ng-if="task.table.isIes" class="report-td">
                                {{day.ies}}
                            </div>
                        </div>
                        <div ng-if="day.view">
                            <div ng-if="!day.loaded" class="report-td"><span><i class="fa fa-spinner fa-spin"></i> Fetching customer data...</span>
                            </div>
                            <div ng-if="day.loaded" class="daily-view">
                                <table class="table table-condensed table-responsive table-bordered">
                                    <thead>
                                    <th class="bg-info">Customer</th>
                                    <th class="bg-info">Worked with the manager</th>
                                    <th class="bg-info">Market Potential Segment
                                    </th>
                                    <th class="bg-info">Actual
                                    </th>
                                    <th class="bg-info">Exam Copies Distribution
                                    </th>
                                    <th class="bg-info">Invitation to Events</th>
                                    <th class="bg-info">
                                        Confirmation of Events
                                    </th>
                                    <th class="bg-info">
                                        Follow up Payment
                                    </th>
                                    <th class="bg-info">
                                        Giveaways Distribution
                                    </th>
                                    <th class="bg-info">
                                        Delivery of Incentive Donation
                                    </th>
                                    <th class="bg-info">
                                        Purchase Order
                                    </th>
                                    <th class="bg-info">
                                        Delivery of Additional Order/TRM/Compli
                                    </th>
                                    <th class="bg-info">
                                        Booklist
                                    </th>
                                    <th class="bg-info">
                                        Updated Customer Info Sheet
                                    </th>
                                    <th class="bg-info">
                                        Implemented Ex Sem
                                    </th>
                                    </thead>
                                    <tbody ng-repeat="(weekday,customers) in day.customers | groupBy:'day' | orderBy:'day'">
                                    <tr>
                                        <td colspan="15" class="bg-danger">{{task.getDayName(weekday)}}</td>
                                    </tr>
                                    <tr ng-repeat="customer in customers"
                                        class="{{customer.planned == true ? 'planned_activity':'unplanned_activity'}}">
                                        <td><a href="#">{{customer.customer}}</a>
                                        </td>

                                        <td>
                                            <i ng-class="customer.workedWith == 1 ? 'fa fa-check text-success':'fa fa-close text-danger'"></i>
                                        </td>

                                        <td>
                                            {{customer.marketSegment}}
                                        </td>
                                        <td>
                                            <i ng-class="customer.actual == 1 ? 'fa fa-check text-success':'fa fa-close text-danger'"></i>
                                        </td>
                                        <td>
                                            <i ng-class="customer.ecd == 1 ? 'fa fa-check text-success':'fa fa-close text-danger'"></i>
                                        </td>
                                        <td>
                                            <i ng-class="customer.ite == 1 ? 'fa fa-check text-success':'fa fa-close text-danger'"></i>
                                        </td>
                                        <td>
                                            <i ng-class="customer.coe == 1 ? 'fa fa-check text-success':'fa fa-close text-danger'"></i>
                                        </td>
                                        <td>
                                            <i ng-class="customer.fp == 1 ? 'fa fa-check text-success':'fa fa-close text-danger'"></i>
                                        </td>
                                        <td>
                                            <i ng-class="customer.gd == 1 ? 'fa fa-check text-success':'fa fa-close text-danger'"></i>
                                        </td>
                                        <td>
                                            <i ng-class="customer.doi == 1 ? 'fa fa-check text-success':'fa fa-close text-danger'"></i>
                                        </td>
                                        <td>
                                            <i ng-class="customer.po == 1 ? 'fa fa-check text-success':'fa fa-close text-danger'"></i>
                                        </td>
                                        <td>
                                            <i ng-class="customer.daotrc == 1 ? 'fa fa-check text-success':'fa fa-close text-danger'"></i>
                                        </td>
                                        <td>
                                            <i ng-class="customer.bookList == 1 ? 'fa fa-check text-success':'fa fa-close text-danger'"></i>
                                        </td>
                                        <td>
                                            <i ng-class="customer.ucis == 1 ? 'fa fa-check text-success':'fa fa-close text-danger'"></i>
                                        </td>
                                        <td>
                                            <i ng-class="customer.ies == 1 ? 'fa fa-check text-success':'fa fa-close text-danger'"></i>
                                        </td>

                                    </tr>
                                    </tbody>
                                </table>

                            </div>
                        </div>


                    </td>
                </tr>

                </tbody>
            </table>
        </div>
    </form>
</div>