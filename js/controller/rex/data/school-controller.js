angular.module("schoolController",["fluid","ngResource"]).controller("schoolCtrl",["$scope","DTOptionsBuilder","DTColumnBuilder","flowMessageService","flowModalService","$compile","$filter","sessionService",function(s,dto,dtc,ms,fm,c,f,ss){var create=new CreateControl;create.id="school_create_ctl",create.action=function(){s.task.schoolCreate={},s.flow.goTo("school_create")};var save=new SaveControl;save.id="school_edit_ctl",save.action=function(){$("#"+s.flow.getElementFlowId("school_submit")).trigger("click")};var deleteCtl=new DeleteControl;deleteCtl.id="school_del_ctl",deleteCtl.action=function(){fm.show(s.flow.getElementFlowId("schoolDeleteModal"))},s.dtOptions=new FlowOptionsGET(dto,s.flow.getHomeUrl(),s,c,ss),s.dtColumns=FlowColumns(dtc),s.dtColumns.push(dtc.newColumn("name").withTitle("Name").withOption("searchable",!0)),s.dtColumns.push(dtc.newColumn("landline").withTitle("Landline").withOption("searchable",!1)),s.dtColumns.push(dtc.newColumn("email").withTitle("Email").withOption("searchable",!0)),s.dtColumns.push(dtc.newColumn("createdDt").withTitle("Created date").withOption("searchable",!1).renderWith(function(data){return renderDate(data,f)})),s.edit=function(id){s.task.schoolEdit={},s.task.tempEdit={},s.flow.goTo("school_edit",id)},s["delete"]=function(data){s.task.schoolEdit=data,fm.show(s.flow.getElementFlowId("schoolDeleteModal"))},s.save=function(){"school_edit"===s.task.page.name?angular.equals(s.task.schoolEdit,s.task.tempEdit)?s.flow.message.info(UI_MESSAGE_NO_CHANGE):s.flow.action("put",s.task.schoolEdit,s.task.schoolEdit.id):"school_create"===s.task.page.name&&s.flow.action("put",s.task.schoolCreate)},s.$on(s.flow.event.getSuccessEventId(),function(event,data,method){"put"===method?"school_edit"===s.task.page.name?(s.task.schoolEdit={},angular.copy(s.task.schoolEdit,s.task.tempEdit),s.flow.goToHome()):"school_create"===s.task.page.name&&(s.task.schoolCreate={},s.flow.goToHome()):"delete"===method&&"school_settings"===s.task.page.name&&s.dtInstance&&s.dtInstance.reloadData()}),s.$on(s.flow.event.getResizeEventId(),function(event,school,size){"school_settings"===school&&s.dtInstance&&s.dtInstance.reloadData()}),s.$on(s.flow.event.getRefreshId(),function(){s.dtInstance&&s.dtInstance.reloadData()}),s.flow.pageCallBack=function(page,data,source){"school_edit"===page?s.task.schoolEdit.id&&"refresh"!==source||(s.task.schoolEdit=data,angular.copy(s.task.schoolEdit,s.task.tempEdit)):"school_settings"===page&&s.dtInstance&&s.dtInstance.reloadData(),s.flow.addControl(save,["school_edit","school_create"]),s.flow.addControl(deleteCtl,"school_edit"),s.flow.addControl(create,"school_settings")},s.deleteConfirm=function(){s.flow.action("delete",s.task.schoolEdit,s.task.schoolEdit.id),fm.hide(s.flow.getElementFlowId("schoolDeleteModal")),"school_settings"!==s.task.page.name&&s.flow.goToHome(),s.dtInstance&&s.dtInstance.reloadData()},s.deleteCancel=function(){fm.hide(s.flow.getElementFlowId("schoolDeleteModal"))}}]);